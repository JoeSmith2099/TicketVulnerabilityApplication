import socket
import hashlib
"""Client Side Python

This program...

@authors:
    *Conner Moeck
    *Noah Neundorfer
    *Joseph Smith

@Date: 
    *Work began - October 15, 2021
    *Work ended - November 19, 2021

This file contains the following functions:
    * sendToServer - returns a 
    * main - the main function of the script
"""


"""Recieves and prints all data sent from server, until "ENDDATA" message is sent

@parameters:
    *s - data to send
"""
def sendToServer(s):
    try:
        client_s.send(s.encode())
    except:
        print("UNKOWN ERROR: Could not send data to server")


"""Recieves and prints all data sent from server, until "ENDDATA" message is sent

"""
def receiveAllData():
    data = client_s.recv(4096).decode()
    while(data != "ENDDATA"):

        print(data)
        data = client_s.recv(4096).decode()

def main():
    print ("Welcome to the Ticket Purchasing Kiosk.")
    print("Please choose from these options-\n")
    while(True):
        menu_options = ["1. Purchase Tickets", "2. View Events", 
                          "3. Login", "4. Register an Account",
                          "5. Purchase Points" , 
                          "7. Account Information", "8. Logout" ,
                          "9. Quit" ]
        for option in menu_options:
            print ("\t"+option)
        print(">", end = "")
        menu_selection = input()

        if menu_selection == "1":
              sendString = "purchaseTickets"#Command to purchase tickets
              print("Ok, What Event would you like tp purchase tickets for?\n>", end = "")
              sendString += ":"+ input().strip()

              sendToServer(sendString)
              receiveAllData()

        elif menu_selection == "2":
              sendString = "listEvents"#Command to receive events list

              sendToServer(sendString)
              receiveAllData()#Receive and print eventList

        elif menu_selection == "3":
              sendString = "login"#Command for function login
              print("Ok, What is your username?\n>", end = "")
              sendString += ":"+ input().strip()
              print("Ok, What is your password?\n>", end = "")
              sendString += ":"+ str((hashlib.sha512((input().strip()).encode())).hexdigest())

              sendToServer(sendString)
              receiveAllData()

        elif menu_selection == "4":   #
              sendString = "registerAccount"#Command for function Refund and Payments function
              print("Ok, Select a username\n>", end = "")
              userName = input().strip()
              while (userName == ""):
                  print("Username field cannot be empty")
                  print("Ok, Select a username\n>", end = "")
                  userName = input().strip()
              sendString += ":"+ userName
              print("Ok, select a password\n>", end = "")
              sendString += ":"+ str((hashlib.sha512((input().strip()).encode())).hexdigest())
              print("Ok, Confirm password\n>", end = "")
              sendString += ":"+ str((hashlib.sha512((input().strip()).encode())).hexdigest())


              sendToServer(sendString)
              receiveAllData()

        elif menu_selection == "5":   #Purchase Points
              sendString = "purchasePoints"#Command for function Refund and Payments function
              print("Ok, How Many points would you like to purchase?\n>", end = "")
              sendString += ":"+ input().strip()

              sendToServer(sendString)
              receiveAllData()

        elif menu_selection == "7":
              sendString = "accountInfo"#Command for getting account information

              sendToServer(sendString)
              receiveAllData()

        elif menu_selection == "8":
              sendString = "logout"#Command for function login

              sendToServer(sendString)
              receiveAllData()

        elif menu_selection == "9":
              print("\Ending connection... ")
              break;

    client_s.close()      # close the socket

host = "127.0.0.1"
port = 35502
client_s = socket.socket()
client_s.connect((host, port))
main()
